<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModelEditor | Dev Blog</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* Стили для форм входа */
        .auth-forms { display: flex; gap: 10px; align-items: center; }
        .auth-btn { background: none; border: 1px solid var(--accent); color: var(--accent); padding: 5px 15px; cursor: pointer; border-radius: 4px; }
        .auth-btn:hover { background: var(--accent); color: white; }
        .user-info { color: white; display: flex; gap: 15px; align-items: center; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #151921; padding: 30px; border-radius: 10px; border: 1px solid #333; width: 300px; }
        .modal input { width: 100%; margin-bottom: 10px; padding: 8px; background: #0b0e14; border: 1px solid #333; color: white; box-sizing: border-box; }
        .modal button { width: 100%; padding: 10px; background: var(--accent); border: none; color: white; cursor: pointer; }
        .close-modal { float: right; cursor: pointer; color: #666; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>Model<span>Editor</span></h1>
                <div class="author">by Today_Idk</div>
            </div>
            <nav>
                <div class="auth-forms">
        <a href="/community" style="margin-right: 20px; font-weight: bold; color: var(--accent);">Community</a>

                    <% if (user) { %>
                        <div class="user-info">
                            <span>Hello, <b><%= user.username %></b></span>
                            <% if (user.role === 'admin') { %>
                                <a href="/admin" class="admin-link">Admin Panel</a>
                            <% } %>
                            <a href="/logout" class="auth-btn">Logout</a>
                        </div>
                    <% } else { %>
                        <button onclick="openModal('loginModal')" class="auth-btn">Login</button>
                        <button onclick="openModal('regModal')" class="auth-btn">Register</button>
                    <% } %>
                </div>
            </nav>
        </div>
    </header>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('loginModal')">&times;</span>
            <h2 style="margin-top:0">Login</h2>
            <form action="/login" method="POST">
                <input type="text" name="username" placeholder="Username" required>
                <input type="password" name="password" placeholder="Password" required>
                <button type="submit">Enter</button>
            </form>
        </div>
    </div>

    <div id="regModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('regModal')">&times;</span>
            <h2 style="margin-top:0">Register</h2>
            <form action="/register" method="POST">
                <input type="text" name="username" placeholder="Username" required>
                <input type="password" name="password" placeholder="Password" required>
                <button type="submit">Create Account</button>
            </form>
        </div>
    </div>

    

    <main class="container">
        <section class="hero">
            <h2>News & Updates</h2>
            <p>Latest updates for ModelEditor. <br>Current Version: <b><%= updates.length > 0 ? updates[0].version : '0.0' %></b></p>
        </section>

        <div class="feed">
            <% if (updates.length > 0) { %>
                <% updates.forEach(post => { %>
                    <article class="post">
                        <div class="post-sidebar">
                            <span class="version">v<%= post.version %></span>
                            <span class="date"><%= post.date %></span>
                        </div>
                        <div class="post-content">
                            <div class="tag"><%= post.tag %></div>
                            <h3><%= post.title %></h3>
                            <p><%= post.text %></p>
                            <% if (post.downloadUrl) { %>
                                <a href="<%= post.downloadUrl %>" class="download-btn">Download ZIP</a>
                            <% } %>
                        </div>
                    </article>
                <% }); %>
            <% } else { %>
                <p class="empty">No news yet.</p>
            <% } %>
        </div>
    </main>

    <script>
        const socket = io();
        const feed = document.querySelector('.feed');

        socket.on('newPost', (post) => {
            const postHTML = `
                <article class="post" style="animation: slideIn 0.5s ease-out; border-color: var(--accent);">
                    <div class="post-sidebar">
                        <span class="version">v${post.version}</span>
                        <span class="date">${post.date}</span>
                    </div>
                    <div class="post-content">
                        <div class="tag">${post.tag}</div>
                        <h3>${post.title}</h3>
                        <p>${post.text}</p>
                        <a href="${post.downloadUrl}" class="download-btn">Download ZIP</a>
                    </div>
                </article>`;
            
            const empty = document.querySelector('.empty');
            if(empty) empty.remove();
            feed.insertAdjacentHTML('afterbegin', postHTML);
        });

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    </script>
</body>
</html>